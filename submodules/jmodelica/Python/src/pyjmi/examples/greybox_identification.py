#!/usr/bin/env python 
# -*- coding: utf-8 -*-

# Copyright (C) 2015 Modelon AB
#
# This program is free software: you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation, version 3 of the License.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program. If not, see <http://www.gnu.org/licenses/>.

# Import library for path manipulations
import os.path

# Import numerical libraries
import numpy as N
import matplotlib.pyplot as plt

# Import the needed JModelica.org Python methods
from pymodelica import compile_fmu
from pyfmi import load_fmu
from pyjmi import transfer_optimization_problem, get_files_path
from pyjmi.optimization.greybox import GreyBox
from collections import OrderedDict

def run_demo():
    """
    
    """
    # Locate the model and file paths 
    file_path = os.path.join(get_files_path(), "DrumBoiler.mop")
    model_name = "DrumBoilerpackage.DrumBoiler"

    # Load measurement data
    RCdata = get_test_data()
    measurements = RCdata['measurements'] 
    time = RCdata['time']
    # Extract control signal data from measurements
    inputs={}
    inputs['uc']= measurements.pop('uc')
    inputs['fc']= measurements.pop('fc')

    # Transfer model to Casadi interface
    op = transfer_optimization_problem(model_name, file_path, accept_model = True)
    op_opts = op.optimize_options()

    # Create greybox object
    GB = GreyBox(op, op_opts, measurements, inputs, time)

    # Set some variable attributes
    GB.set_variable_attribute(GB.get_noise_covariance_variable('E'), 'max', 100)
    GB.set_variable_attribute(GB.get_noise_covariance_variable('P'), 'max', 100)
    GB.set_variable_attribute('x10', 'initialGuess', 148)
    GB.set_variable_attribute('x20', 'initialGuess', 27.5)
    
    # Define null model free parameters and other parameters to free
    nullModelFree = set(['GreyBox_r_E', 'GreyBox_r_P', 'x10', 'x20'])
    optimizeParameters = set(["TD","TR","A4","distE","distP"])
    
       # Define null model free parameters and other parameters to free
    nullModelFree = set(['GreyBox_r_E', 'GreyBox_r_P', 'x10', 'x20'])
    
    # Optimize null model
    identification = GB.identify(nullModelFree)
    

    # Create dictionaries for results
    testcases = []
    
    for var in optimizeParameters:
        # Add var to set of free parameters
        testcases.append(identification.release([var]))
    
    print("=======================SUMMARY========================")

    results = identification.compare(testcases)

    # reference data
    nullModelReferenceCost = 5631.068823 #the cost from the null model
    reference = {'TD':{'cost':5466.596971, 'costred':164.471852, 'risk':0.000000},'TR':{'cost':5629.636935, 'costred':1.431888, 'risk':0.731872},'A4':{'cost':5630.900339, 'costred':0.168484, 'risk':0.996721}
                ,'distE':{'cost':4362.561987, 'costred':1268.506836, 'risk':0.000000},'distP':{'cost':4399.728897, 'costred':1231.339926, 'risk':0.000000}} #Create reference by running without framework
    tol = 1e-3
      
    # Assert nullmodel 
    assert(N.abs(identification.cost - nullModelReferenceCost) < tol)
    
    # Assert results  
    for i, var in enumerate(optimizeParameters):
        assert(N.abs(results[i]['cost'] - reference[var]['cost']) < tol)
        assert(N.abs(results[i]['costred'] - reference[var]['costred']) < tol)
        assert(N.abs(results[i]['risk'] - reference[var]['risk']) < tol)

def get_test_data():
	
    return OrderedDict([('measurements', OrderedDict([('E', N.array([ 133.83652165,  132.49324086,  129.12398945,  124.58144881,
        123.86837942,  122.8498228 ,  120.6938312 ,  119.34490856,
        117.04370551,  116.74414273,  115.6417485 ,  114.50741678,
        113.10197835,  112.48334577,  112.26240323,  110.55129041,
        110.13604616,  110.19356031,  110.26663918,  107.96740406,
        109.46607729,  106.82350363,  109.00195776,  107.58561734,
        106.85269681,  106.75819995,  106.60396388,  106.85030183,
        108.8205896 ,  106.52282159,  106.98989088,  106.93545199,
        105.02204529,  106.70653435,  106.36668795,  107.21526711,
        106.76157533,  106.9742844 ,  105.70609171,  106.37591991,
        107.4191151 ,  105.79035292,  106.16140759,  105.27837982,
        106.0684963 ,  106.07444292,  106.61395481,  106.45325511,
        106.07896146,  105.82768848,  106.90166857,  106.13269302,
        106.7255401 ,  105.68719492,  105.86373095,  107.30162814,
        107.50601076,  105.088683  ,  107.18564646,  106.68036281,
        105.14801105,  106.02448378,  106.48341199,  106.43343635,
        105.83248156,  106.53521087,  107.74000459,  106.76152281,
        106.81147684,  105.85173486,  107.31445048,  106.20072485,
        106.76253074,  106.61487854,  108.36865556,  106.66804033,
        106.86357588,  106.83049647,  106.64979596,  106.7398408 ,
        106.98582833,  108.0989619 ,  108.9681865 ,  107.14682556,
        105.97609418,  107.18706487,  108.02148627,  106.94017085,
        106.98631816,  107.30376906,  109.16470539,  108.1289551 ,
        108.19599786,  108.15382898,  109.18178204,  108.28323827,
        107.48626422,  107.87448882,  107.33685288,  108.13162534,
        107.74842156,  108.45976832,  107.17906883,  108.41243508,
        107.37397104,  108.68574986,  109.17479673,  109.2299648 ,
        108.11157218,  108.89123459,  108.58875896,  109.65315869,
        109.42164049,  109.05668408,  108.47903633,  108.70335026,
        109.75420684,  108.16395856,  108.32169271,  109.39317311,
        108.76089647,  108.66165349,  107.50830492,  109.05622987,
        110.22996353,  110.44863869,  108.56985872,  109.69802821,
        108.30641486,  108.85979329,  109.44888741,  109.2056885 ,
        107.13845662,  110.1667989 ,  109.52379629,  109.64757495,
        110.64155568,  110.57187803,  109.86094007,  108.93010667,
        108.84549655,  109.46481551,  109.50335841,  110.01031796,
        108.38742356,  108.81076069,  109.9020123 ,  109.38680879,
        110.96544201,  109.91794739,  109.85852692,  110.43152365,
        110.01813645,  111.53894888,  109.72897818,  132.82892572,
        136.00671478,  140.14138475,  142.11019294,  145.39126795,
        148.6134608 ,  150.13658425,  152.60287628,  154.30929772,
        156.41694118,  156.396554  ,  158.92834589,  159.00261895,
        160.64207985,  162.37479577,  162.68562253,  163.47984952,
        165.25577403,  164.50606292,  165.19365431,  164.37468979,
        165.1504336 ,  165.82663648,  165.09806236,  166.02955603,
        165.51825101,  145.50544106,  142.58935192,  139.11260637,
        135.80916465,  132.00284745,  130.61457572,  126.59364737,
        125.82961138,  122.94520357,  123.06273879,  120.73315559,
        118.7548476 ,  116.96336782,  115.30806468,  115.4354383 ,
        116.83909017,  112.61563863,  113.64422475,  112.02248067,
        110.5869166 ,  111.48270266,  110.92947455,  110.00535383,
        109.56697119,  110.11181049,  109.54603385,  109.00828634,
        108.49287237,  107.61033153,  108.5455018 ,  108.36662926,
        107.2967489 ,  108.54117683,  107.66895201,  108.15466439,
        106.93540556,  108.52791103,  107.60085074,  107.84471661,
        106.19780743,  108.41609232,  107.56326682,  107.07811109,
        107.63276902,  107.03935831,  106.94915772,  106.45531606,
        106.16388705,  105.51397174,  107.74185008,  107.90974531,
        106.42481655,  107.80351573,  106.96538398,  106.99961   ,
        106.74555262,  106.7671346 ,  107.10491397,  106.74041132,
        107.71834142,  107.20182891,  108.40935213,  107.78578214,
        108.52157893,  109.25906618,  108.11112577,  108.99462552,
        106.7614757 ,  108.98841276,  109.91116402,  109.68787945,
        109.34431487,  109.56072562,  109.14873791,  110.24687274,
        109.34809298,  110.21453379,  108.66453935,  109.36156826,
        110.39142312,  110.35141168,  110.53289301,  112.26980026,
        111.09812138,  111.2824434 ,  133.45270009,  137.99398976,
        140.8192858 ,  144.56563712,  148.18001275,  151.3529027 ,
        154.97821615,  157.32812991,  159.48568238,  161.20137915,
        162.37062406,  164.09658089,  165.47288565,  164.77079375,
        166.45391017,  168.15297469,  168.42526615,  169.23092836,
        169.76325852,  170.4014486 ,  171.0736269 ,  171.69539404,
        172.0294904 ,  170.94560212,  170.16222582,  172.98800617,
        172.5168534 ,  171.54540605,  172.04366776,  172.17047508,
        171.60369359,  170.72827439,  171.04172264,  170.76296345,
        171.4701228 ,  170.99098661,  171.58693742,  169.75533362,
        169.983069  ,  170.15250563,  169.96579418,  169.25261721,
        168.73631138,  169.64391259,  168.98667752,  168.06466266,
        168.58657544,  168.66626911,  168.20106956,  167.83027526,
        169.1604434 ,  168.55541532,  169.09316879,  167.06694253,
        168.06749131,  167.4690863 ,  166.35860163,  167.40722966,
        168.25258259,  167.38298207,  168.32866536,  168.17610506,
        167.86380207,  166.00216989,  147.12993978,  142.14153201,
        139.18957548,  136.26852676,  133.11191445,  130.9697674 ,
        127.6385119 ,  125.54385108,  123.95525563,  123.1367453 ,
        121.04989304,  118.73974446,  118.35907153,  117.01660098,
        116.68972008,  115.74740748,  114.34800904,  113.49358999,
        113.7437307 ,  112.4433921 ,  112.70959774,  113.44238362,
        111.71878976,  113.32844843,  110.75158855,  110.6000794 ,
        111.57120912,  110.02191808,  111.69693604,  111.89122506,
        112.01751283,  111.2250895 ,  110.90675974,  111.22038987,
        109.3695462 ,  111.06361753,  112.17109348,  110.94828567,
        111.10168794,  108.40591734,  111.63253977,  111.52985246,
        111.65297256,  110.87427619,  110.70406174,  110.76142202,
        111.84536882,  111.86315784,  112.94381713,  111.90672575,
        112.98096358,  112.64695415,  113.24498221,  112.54106585,
        113.50709944,  113.15694453,  111.43043042,  113.0094703 ,
        114.55648999,  112.51336031,  114.06644622,  113.33199014,
        113.17658697,  113.796485  ,  114.87078443,  113.9338196 ,
        113.73148623,  113.49368508,  113.89134294,  114.22078633,
        115.63736866,  115.00403125,  116.11425783,  115.05923961,
        115.92048733,  116.47197557,  115.53377152,  117.18268088,
        116.41347814,  117.4678492 ,  115.55638108,  115.33352805,
        117.54871351,  116.23216443,  116.56058179,  117.69579059,
        117.37628362,  117.11624802,  116.81672197,  116.68526185,
        115.85964218,  115.78443341,  117.53781476,  116.90754174,
        116.32755272,  115.52439557,  116.2825156 ,  117.07832733,
        117.0548864 ,  118.04014892,  117.51629167,  116.89400761,
        117.62210942,  117.13922221,  117.48089532,  117.70597859,
        118.94391228,  117.7592832 ,  117.21726314,  117.89509647,
        118.55837742,  118.84228535,  118.7438889 ,  119.08747993,
        119.20108404,  119.40155388,  119.17685681,  118.24480776,
        119.32916778,  118.62922317,  119.42705489,  119.96726463,
        118.88672973,  119.5761234 ,  120.50983131,  120.91761829,
        120.64176774,  120.36475636,  121.03944088,  122.12281686,
        120.82524479,  120.16640763,  120.11009924,  121.73278772,
        120.62223263,  120.56246248,  120.90047166,  122.72601285,
        122.49081673,  121.86405062,  122.695156  ,  122.73489516,
        146.45838783,  151.95654141,  155.14220409,  159.20727545,
        163.3284369 ,  166.4485252 ,  167.91412185,  170.54215218,
        173.11288788,  174.70572197,  177.72273355,  177.65460867,
        180.02504964,  180.48840704,  182.74260079,  183.56599677,
        183.67102616,  183.78188932,  185.09350386,  185.26982376,
        185.83915005,  186.05494727,  187.14310408,  185.89233131,
        185.24188627,  185.89047941,  185.85546446,  187.03223843])), ('P', N.array([ 138.        ,  141.15550069,  132.90587337,  137.96121494,
        139.11888972,  129.64732248,  140.51463478,  138.30111936,
        137.16333808,  136.503006  ,  135.75627388,  133.51377271,
        140.20615377,  132.60329241,  139.55646587,  138.06718308,
        140.0786318 ,  135.10688891,  135.9406307 ,  143.29170968,
        134.45946406,  146.61278218,  135.54037789,  136.03614019,
        139.22206768,  138.9337922 ,  142.35790061,  144.93157761,
        140.70625734,  134.38563006,  138.95726545,  138.33713139,
        149.51671968,  134.80139404,  142.85343574,  140.84438142,
        139.9476358 ,  142.23046844,  139.4333152 ,  139.79411337,
        139.47831908,  144.37484417,  142.19102281,  138.86855009,
        143.87006193,  138.2408164 ,  144.27171333,  140.65061436,
        146.61785508,  138.17281824,  141.73703484,  140.54497036,
        140.36564948,  143.48507265,  146.15252718,  139.24280119,
        140.82689601,  142.51472767,  146.0681348 ,  143.11447343,
        145.27455532,  139.69745669,  137.74139738,  141.03158134,
        143.34292021,  136.38191648,  143.81542734,  146.25165525,
        142.97699754,  143.32234466,  144.5167453 ,  141.23335561,
        137.65100876,  147.23420725,  143.18154529,  146.33333022,
        146.11999618,  143.02874517,  141.27301569,  140.25711403,
        136.46031484,  144.3445222 ,  142.25562499,  145.45015629,
        149.87008682,  142.02422755,  144.58730081,  143.11995421,
        146.41817773,  146.32380135,  147.49516236,  146.77573596,
        146.09825698,  142.83649069,  145.22174958,  138.63870164,
        142.43020546,  149.16789096,  146.17227265,  144.59032223,
        152.74972953,  139.80283235,  141.85976395,  143.49932453,
        145.48794381,  143.58947117,  144.48881063,  146.49795734,
        143.88091811,  146.56888108,  143.9259998 ,  153.24243879,
        145.49855709,  146.86732912,  143.91102695,  148.17168629,
        149.52439286,  149.81906548,  145.79784053,  144.14191756,
        150.32161473,  149.73513554,  148.03778722,  144.72660927,
        144.53735029,  150.58223278,  138.62031024,  148.08576414,
        148.28007191,  154.89262225,  151.43083766,  146.45043186,
        144.97905209,  143.62674248,  149.27658014,  145.95602757,
        145.42010998,  147.71362604,  154.19294865,  149.73368618,
        150.71771691,  150.59658206,  145.86037003,  140.75719026,
        152.24324291,  149.85301657,  148.41429062,  147.91133185,
        146.94531155,  144.53779508,  147.66558901,  151.16822281,
        150.16971618,  149.09402423,  143.60906268,  150.18734377,
        148.54296934,  152.05529044,  148.22639292,  148.07974441,
        147.1334656 ,  143.57939474,  142.75774259,  146.37420684,
        150.1626595 ,  145.66481292,  140.97074153,  144.47289642,
        139.9561093 ,  144.40109366,  146.81713693,  135.46529001,
        141.71105186,  137.0098491 ,  141.11136435,  137.75433027,
        145.66509655,  136.52339612,  139.7900916 ,  138.22407931,
        140.98977749,  139.55674866,  137.48665235,  141.66666658,
        141.81152608,  139.07031631,  134.63476526,  137.89415302,
        135.3238339 ,  136.5982599 ,  140.76544058,  145.63384713,
        139.5774202 ,  138.63291248,  135.29154104,  139.05288845,
        142.9774273 ,  143.74819042,  139.94077465,  140.88022336,
        147.81013808,  143.35070677,  144.77251457,  138.64750624,
        143.18277521,  138.55909935,  138.42631034,  142.47616544,
        138.47176837,  138.95916911,  143.02358731,  139.11114199,
        145.116329  ,  140.60657022,  143.96108659,  142.4771507 ,
        149.27286124,  139.09284437,  137.18789843,  145.4292894 ,
        143.51472804,  143.06744784,  144.50464966,  138.21575493,
        144.42140972,  141.28790346,  141.76215875,  145.12107733,
        143.94775746,  143.39081775,  143.93806797,  144.97351307,
        139.99884346,  136.89315146,  136.7119103 ,  146.22567466,
        139.59775412,  145.82621868,  144.96953489,  146.72237908,
        145.53013541,  147.52358554,  142.40505867,  144.23341358,
        143.55472315,  151.92750584,  150.03777919,  144.41563461,
        145.29102841,  150.6163087 ,  149.47668714,  144.96389382,
        152.33811846,  145.25038872,  148.15867766,  149.29054022,
        148.95798297,  152.12802981,  141.92002184,  145.43686485,
        152.46881416,  147.61609551,  153.00466387,  147.55077989,
        154.69087067,  146.99202711,  152.4103283 ,  145.80006355,
        155.09182534,  154.17469524,  149.3452422 ,  144.8502694 ,
        154.72012176,  149.86586699,  148.74456291,  145.0976364 ,
        151.29301424,  153.8415059 ,  147.72262117,  158.68386588,
        150.62820615,  150.47330921,  151.8663967 ,  145.11901927,
        146.17858882,  154.20730129,  143.72107235,  143.46830405,
        140.71075048,  142.87998666,  145.58171748,  151.27094867,
        142.71684092,  143.94040421,  152.06079455,  139.46038567,
        142.29620293,  142.98850483,  144.92633914,  141.95856742,
        141.60558163,  142.37174314,  136.78313996,  137.16231021,
        139.25460299,  136.05182333,  137.98759294,  139.10984987,
        135.44262102,  139.01029023,  137.39229843,  134.58544709,
        140.11610053,  143.32767803,  143.36770217,  140.47542643,
        138.36395056,  135.4610387 ,  144.41562515,  136.1289445 ,
        137.14004385,  138.31226137,  140.28598946,  133.306958  ,
        131.65814272,  138.60619749,  140.92839722,  136.11057459,
        132.71962806,  140.65310355,  138.31227759,  141.90220677,
        137.67664304,  144.01512397,  148.29050026,  134.2939259 ,
        136.73312162,  142.33649367,  139.31638928,  137.29896425,
        143.5117626 ,  146.21210495,  144.64852076,  139.12961393,
        146.30278251,  142.4699473 ,  146.81801734,  140.98862663,
        141.51563268,  138.82986931,  138.9644567 ,  151.20928676,
        146.59220376,  148.41422698,  140.80751757,  150.56383017,
        145.17401509,  148.53937441,  148.64937044,  141.13172509,
        142.05274253,  148.4566532 ,  152.49225265,  143.5948311 ,
        147.31505477,  152.1706036 ,  153.29048954,  150.43891702,
        144.70872664,  146.03256887,  151.23883826,  149.20008471,
        147.39301641,  148.10361548,  156.20767866,  150.6935899 ,
        150.75117084,  152.74369108,  150.63230311,  150.61427063,
        152.43878572,  155.86576373,  151.22196475,  152.6554872 ,
        150.22416522,  157.98792456,  156.65967776,  149.60479755,
        155.40876885,  158.33944532,  155.67221252,  153.99957211,
        155.48580035,  156.84096714,  152.8801294 ,  156.29541564,
        163.61479245,  155.95869622,  154.48107476,  160.38578083,
        159.34953171,  157.44071508,  160.14566485,  159.61958858,
        156.59875646,  156.92609325,  160.78659103,  157.33273286,
        154.44639806,  160.58732385,  164.26632574,  159.82531965,
        160.23548277,  156.67810555,  158.61745798,  158.5836214 ,
        156.36794522,  155.84882181,  160.08155406,  160.28087118,
        160.42951965,  166.82170159,  158.19778405,  157.77320795,
        159.3825922 ,  156.72819087,  162.40407672,  164.02907686,
        161.21703334,  160.30016036,  160.98618578,  159.64918985,
        160.92423266,  166.61147353,  152.58407292,  164.29497012,
        159.08809344,  162.97833329,  161.58214736,  165.13785884,
        158.50678503,  165.47967254,  164.10117477,  162.04104131,
        160.6370542 ,  160.02412577,  161.40666613,  161.26874412,
        164.7368683 ,  160.5145731 ,  163.25788811,  165.48475763,
        157.22243508,  166.08968554,  166.21588194,  166.8473248 ,
        162.77736696,  165.645338  ,  168.63515435,  166.17776123,
        161.18449905,  162.92422382,  166.31523621,  164.5484016 ,
        162.54746832,  170.15064938,  165.83099467,  171.35369447,
        172.57787841,  173.70061732,  166.67259722,  168.88853   ,
        166.4418668 ,  168.63471615,  167.40688359,  163.56043779,
        169.74451917,  167.40135438,  167.99709144,  166.96421614,
        169.25273613,  165.63910869,  166.76189195,  169.39030269,
        165.67034805,  159.37744525,  164.73363393,  164.8492175 ,
        166.65481331,  166.08329802,  163.89012794,  166.24368541,
        157.50865563,  157.58143387,  161.16033689,  158.26271291,
        156.3655202 ,  164.20977969,  158.07209683,  157.48683847])), ('uc', N.array([ 0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  1.00001,
        1.00001,  1.00001,  1.00001,  1.00001,  1.00001,  1.00001,
        1.00001,  1.00001,  1.00001,  1.00001,  1.00001,  1.00001,
        1.00001,  1.00001,  1.00001,  1.00001,  1.00001,  1.00001,
        1.00001,  1.00001,  1.00001,  1.00001,  1.00001,  1.00001,
        1.00001,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  1.00001,  1.00001,  1.00001,  1.00001,
        1.00001,  1.00001,  1.00001,  1.00001,  1.00001,  1.00001,
        1.00001,  1.00001,  1.00001,  1.00001,  1.00001,  1.00001,
        1.00001,  1.00001,  1.00001,  1.00001,  1.00001,  1.00001,
        1.00001,  1.00001,  1.00001,  1.00001,  1.00001,  1.00001,
        1.00001,  1.00001,  1.00001,  1.00001,  1.00001,  1.00001,
        1.00001,  1.00001,  1.00001,  1.00001,  1.00001,  1.00001,
        1.00001,  1.00001,  1.00001,  1.00001,  1.00001,  1.00001,
        1.00001,  1.00001,  1.00001,  1.00001,  1.00001,  1.00001,
        1.00001,  1.00001,  1.00001,  1.00001,  1.00001,  1.00001,
        1.00001,  1.00001,  1.00001,  1.00001,  1.00001,  1.00001,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  0.59999,  0.59999,
        0.59999,  0.59999,  0.59999,  0.59999,  1.00001,  1.00001,
        1.00001,  1.00001,  1.00001,  1.00001,  1.00001,  1.00001,
        1.00001,  1.00001,  1.00001,  1.00001,  1.00001,  1.00001,
        1.00001,  1.00001,  1.00001,  1.00001,  1.00001,  1.00001,
        1.00001,  1.00001,  1.00001,  1.00001,  1.00001,  1.00001,
        1.00001,  1.00001])), ('fc', N.array([ 23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  32.00001,  32.00001,  32.00001,  32.00001,
        32.00001,  32.00001,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999,  23.99999,  23.99999,  23.99999,  23.99999,
        23.99999,  23.99999]))])), ('time', N.array([    0.        ,     2.00400802,     4.00801603,     6.01202405,
           8.01603206,    10.02004008,    12.0240481 ,    14.02805611,
          16.03206413,    18.03607214,    20.04008016,    22.04408818,
          24.04809619,    26.05210421,    28.05611222,    30.06012024,
          32.06412826,    34.06813627,    36.07214429,    38.0761523 ,
          40.08016032,    42.08416834,    44.08817635,    46.09218437,
          48.09619238,    50.1002004 ,    52.10420842,    54.10821643,
          56.11222445,    58.11623246,    60.12024048,    62.1242485 ,
          64.12825651,    66.13226453,    68.13627255,    70.14028056,
          72.14428858,    74.14829659,    76.15230461,    78.15631263,
          80.16032064,    82.16432866,    84.16833667,    86.17234469,
          88.17635271,    90.18036072,    92.18436874,    94.18837675,
          96.19238477,    98.19639279,   100.2004008 ,   102.20440882,
         104.20841683,   106.21242485,   108.21643287,   110.22044088,
         112.2244489 ,   114.22845691,   116.23246493,   118.23647295,
         120.24048096,   122.24448898,   124.24849699,   126.25250501,
         128.25651303,   130.26052104,   132.26452906,   134.26853707,
         136.27254509,   138.27655311,   140.28056112,   142.28456914,
         144.28857715,   146.29258517,   148.29659319,   150.3006012 ,
         152.30460922,   154.30861723,   156.31262525,   158.31663327,
         160.32064128,   162.3246493 ,   164.32865731,   166.33266533,
         168.33667335,   170.34068136,   172.34468938,   174.34869739,
         176.35270541,   178.35671343,   180.36072144,   182.36472946,
         184.36873747,   186.37274549,   188.37675351,   190.38076152,
         192.38476954,   194.38877756,   196.39278557,   198.39679359,
         200.4008016 ,   202.40480962,   204.40881764,   206.41282565,
         208.41683367,   210.42084168,   212.4248497 ,   214.42885772,
         216.43286573,   218.43687375,   220.44088176,   222.44488978,
         224.4488978 ,   226.45290581,   228.45691383,   230.46092184,
         232.46492986,   234.46893788,   236.47294589,   238.47695391,
         240.48096192,   242.48496994,   244.48897796,   246.49298597,
         248.49699399,   250.501002  ,   252.50501002,   254.50901804,
         256.51302605,   258.51703407,   260.52104208,   262.5250501 ,
         264.52905812,   266.53306613,   268.53707415,   270.54108216,
         272.54509018,   274.5490982 ,   276.55310621,   278.55711423,
         280.56112224,   282.56513026,   284.56913828,   286.57314629,
         288.57715431,   290.58116232,   292.58517034,   294.58917836,
         296.59318637,   298.59719439,   300.6012024 ,   302.60521042,
         304.60921844,   306.61322645,   308.61723447,   310.62124248,
         312.6252505 ,   314.62925852,   316.63326653,   318.63727455,
         320.64128257,   322.64529058,   324.6492986 ,   326.65330661,
         328.65731463,   330.66132265,   332.66533066,   334.66933868,
         336.67334669,   338.67735471,   340.68136273,   342.68537074,
         344.68937876,   346.69338677,   348.69739479,   350.70140281,
         352.70541082,   354.70941884,   356.71342685,   358.71743487,
         360.72144289,   362.7254509 ,   364.72945892,   366.73346693,
         368.73747495,   370.74148297,   372.74549098,   374.749499  ,
         376.75350701,   378.75751503,   380.76152305,   382.76553106,
         384.76953908,   386.77354709,   388.77755511,   390.78156313,
         392.78557114,   394.78957916,   396.79358717,   398.79759519,
         400.80160321,   402.80561122,   404.80961924,   406.81362725,
         408.81763527,   410.82164329,   412.8256513 ,   414.82965932,
         416.83366733,   418.83767535,   420.84168337,   422.84569138,
         424.8496994 ,   426.85370741,   428.85771543,   430.86172345,
         432.86573146,   434.86973948,   436.87374749,   438.87775551,
         440.88176353,   442.88577154,   444.88977956,   446.89378758,
         448.89779559,   450.90180361,   452.90581162,   454.90981964,
         456.91382766,   458.91783567,   460.92184369,   462.9258517 ,
         464.92985972,   466.93386774,   468.93787575,   470.94188377,
         472.94589178,   474.9498998 ,   476.95390782,   478.95791583,
         480.96192385,   482.96593186,   484.96993988,   486.9739479 ,
         488.97795591,   490.98196393,   492.98597194,   494.98997996,
         496.99398798,   498.99799599,   501.00200401,   503.00601202,
         505.01002004,   507.01402806,   509.01803607,   511.02204409,
         513.0260521 ,   515.03006012,   517.03406814,   519.03807615,
         521.04208417,   523.04609218,   525.0501002 ,   527.05410822,
         529.05811623,   531.06212425,   533.06613226,   535.07014028,
         537.0741483 ,   539.07815631,   541.08216433,   543.08617234,
         545.09018036,   547.09418838,   549.09819639,   551.10220441,
         553.10621242,   555.11022044,   557.11422846,   559.11823647,
         561.12224449,   563.12625251,   565.13026052,   567.13426854,
         569.13827655,   571.14228457,   573.14629259,   575.1503006 ,
         577.15430862,   579.15831663,   581.16232465,   583.16633267,
         585.17034068,   587.1743487 ,   589.17835671,   591.18236473,
         593.18637275,   595.19038076,   597.19438878,   599.19839679,
         601.20240481,   603.20641283,   605.21042084,   607.21442886,
         609.21843687,   611.22244489,   613.22645291,   615.23046092,
         617.23446894,   619.23847695,   621.24248497,   623.24649299,
         625.250501  ,   627.25450902,   629.25851703,   631.26252505,
         633.26653307,   635.27054108,   637.2745491 ,   639.27855711,
         641.28256513,   643.28657315,   645.29058116,   647.29458918,
         649.29859719,   651.30260521,   653.30661323,   655.31062124,
         657.31462926,   659.31863727,   661.32264529,   663.32665331,
         665.33066132,   667.33466934,   669.33867735,   671.34268537,
         673.34669339,   675.3507014 ,   677.35470942,   679.35871743,
         681.36272545,   683.36673347,   685.37074148,   687.3747495 ,
         689.37875752,   691.38276553,   693.38677355,   695.39078156,
         697.39478958,   699.3987976 ,   701.40280561,   703.40681363,
         705.41082164,   707.41482966,   709.41883768,   711.42284569,
         713.42685371,   715.43086172,   717.43486974,   719.43887776,
         721.44288577,   723.44689379,   725.4509018 ,   727.45490982,
         729.45891784,   731.46292585,   733.46693387,   735.47094188,
         737.4749499 ,   739.47895792,   741.48296593,   743.48697395,
         745.49098196,   747.49498998,   749.498998  ,   751.50300601,
         753.50701403,   755.51102204,   757.51503006,   759.51903808,
         761.52304609,   763.52705411,   765.53106212,   767.53507014,
         769.53907816,   771.54308617,   773.54709419,   775.5511022 ,
         777.55511022,   779.55911824,   781.56312625,   783.56713427,
         785.57114228,   787.5751503 ,   789.57915832,   791.58316633,
         793.58717435,   795.59118236,   797.59519038,   799.5991984 ,
         801.60320641,   803.60721443,   805.61122244,   807.61523046,
         809.61923848,   811.62324649,   813.62725451,   815.63126253,
         817.63527054,   819.63927856,   821.64328657,   823.64729459,
         825.65130261,   827.65531062,   829.65931864,   831.66332665,
         833.66733467,   835.67134269,   837.6753507 ,   839.67935872,
         841.68336673,   843.68737475,   845.69138277,   847.69539078,
         849.6993988 ,   851.70340681,   853.70741483,   855.71142285,
         857.71543086,   859.71943888,   861.72344689,   863.72745491,
         865.73146293,   867.73547094,   869.73947896,   871.74348697,
         873.74749499,   875.75150301,   877.75551102,   879.75951904,
         881.76352705,   883.76753507,   885.77154309,   887.7755511 ,
         889.77955912,   891.78356713,   893.78757515,   895.79158317,
         897.79559118,   899.7995992 ,   901.80360721,   903.80761523,
         905.81162325,   907.81563126,   909.81963928,   911.82364729,
         913.82765531,   915.83166333,   917.83567134,   919.83967936,
         921.84368737,   923.84769539,   925.85170341,   927.85571142,
         929.85971944,   931.86372745,   933.86773547,   935.87174349,
         937.8757515 ,   939.87975952,   941.88376754,   943.88777555,
         945.89178357,   947.89579158,   949.8997996 ,   951.90380762,
         953.90781563,   955.91182365,   957.91583166,   959.91983968,
         961.9238477 ,   963.92785571,   965.93186373,   967.93587174,
         969.93987976,   971.94388778,   973.94789579,   975.95190381,
         977.95591182,   979.95991984,   981.96392786,   983.96793587,
         985.97194389,   987.9759519 ,   989.97995992,   991.98396794,
         993.98797595,   995.99198397,   997.99599198,  1000.        ])), ('N_meas', 500)])
      

      

if __name__=="__main__":
    run_demo()
